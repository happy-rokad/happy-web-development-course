import { createSlice } from '@reduxjs/toolkit';

const userSlice = createSlice({
    name: 'user',
    initialState: { isLoggedIn: false, userInfo: null },
    reducers: {
        login(state, action) {
            state.isLoggedIn = true;
            state.userInfo = action.payload;
            localStorage.setItem('user', JSON.stringify(state.userInfo)); // Store user info in localStorage

            // Load the user's cart from localStorage based on the user's email
            const userEmail = action.payload.email;
            const storedCart = JSON.parse(localStorage.getItem(`cart_${userEmail}`));
            if (storedCart) {
                state.cart.items = storedCart; // Load the user's cart into Redux state
            }
        },
        logout(state) {
            state.isLoggedIn = false;
            state.userInfo = null;
            localStorage.removeItem('user'); // Remove user from localStorage

            // Reset cart and remove it from localStorage
            const userEmail = state.userInfo?.email;
            if (userEmail) {
                localStorage.removeItem(`cart_${userEmail}`);
            }
            // state.cart.items = []; // Reset Redux cart
        },
        loadUser(state) {
            const storedUser = localStorage.getItem('user');
            if (storedUser) {
                state.isLoggedIn = true;
                state.userInfo = JSON.parse(storedUser);
            }
        },
    },
});

export const { login, logout, loadUser } = userSlice.actions;
export default userSlice.reducer;
